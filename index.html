<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Food Diary - Web Dashboard v2</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
    
    .app-container { display: flex; min-height: 100vh; }
    .sidebar { width: 250px; background: #4CAF50; color: white; padding: 20px; position: fixed; height: 100vh; }
    .sidebar h1 { font-size: 24px; margin-bottom: 30px; }
    .nav-item { display: flex; align-items: center; padding: 12px 16px; cursor: pointer; border-radius: 8px; margin-bottom: 4px; transition: background 0.2s; }
    .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.15); }
    .nav-item span { margin-left: 12px; }
    
    .main-content { flex: 1; margin-left: 250px; padding: 30px; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .header h2 { font-size: 28px; color: #333; }
    .date-badge { background: #4CAF50; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; }
    
    .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .card-title { font-size: 14px; color: #666; margin-bottom: 12px; }
    .big-number { font-size: 48px; font-weight: bold; color: #4CAF50; }
    .big-number.over { color: #f44336; }
    .subtitle { font-size: 14px; color: #999; }
    
    .macro-row { display: flex; justify-content: space-between; margin-top: 12px; }
    .macro-item { display: flex; align-items: center; gap: 6px; }
    .macro-dot { width: 10px; height: 10px; border-radius: 50%; }
    .macro-text { font-size: 12px; color: #666; }
    
    .quick-actions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 30px; }
    .action-btn { background: white; border: none; padding: 20px; border-radius: 12px; cursor: pointer; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.08); transition: transform 0.2s; }
    .action-btn:hover { transform: translateY(-2px); }
    .action-icon { font-size: 28px; margin-bottom: 8px; }
    .action-text { font-size: 14px; color: #333; }
    
    .section-title { font-size: 18px; font-weight: 600; color: #333; margin-bottom: 16px; }
    .meals-list { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .meal-item { display: flex; justify-content: space-between; padding: 16px 20px; border-bottom: 1px solid #f0f0f0; }
    .meal-item:last-child { border-bottom: none; }
    .meal-name { font-size: 16px; color: #333; }
    .meal-calories { font-size: 16px; color: #666; }
    
    .water-section { background: white; border-radius: 12px; padding: 20px; margin-top: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .water-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .water-count { font-size: 36px; font-weight: bold; color: #2196F3; }
    .water-icons { display: flex; flex-wrap: wrap; gap: 4px; }
    .water-icon { font-size: 20px; }
    
    .barcode-input-section { background: white; border-radius: 12px; padding: 20px; margin-top: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .barcode-input-group { display: flex; gap: 12px; margin-top: 12px; }
    .barcode-input { flex: 1; padding: 12px 16px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
    .barcode-input:focus { border-color: #4CAF50; outline: none; }
    .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500; transition: background 0.2s; }
    .btn-primary { background: #4CAF50; color: white; }
    .btn-primary:hover { background: #43A047; }
    
    .product-result { background: #f8f9fa; border-radius: 8px; padding: 16px; margin-top: 16px; }
    .product-name { font-size: 18px; font-weight: 600; margin-bottom: 4px; }
    .product-brand { font-size: 14px; color: #666; margin-bottom: 12px; }
    .nutrition-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    .nutrition-item { text-align: center; }
    .nutrition-value { font-size: 20px; font-weight: bold; color: #4CAF50; }
    .nutrition-label { font-size: 12px; color: #666; }
    
    .add-to-meal { margin-top: 16px; padding-top: 16px; border-top: 1px solid #ddd; }
    .meal-selector { display: flex; gap: 8px; margin-bottom: 12px; }
    .meal-option { flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.2s; }
    .meal-option.active { background: #4CAF50; border-color: #4CAF50; color: white; }
    
    .serving-control { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
    .serving-btn { width: 40px; height: 40px; border: none; background: #f0f0f0; border-radius: 8px; font-size: 20px; cursor: pointer; }
    .serving-value { font-size: 24px; font-weight: bold; min-width: 60px; text-align: center; }
  </style>
</head>
<body>
  <div class="app-container">
    <aside class="sidebar">
      <h1>üçΩÔ∏è Food Diary</h1>
      <nav>
        <div class="nav-item active">
          <span>üè†</span><span>Home</span>
        </div>
        <div class="nav-item">
          <span>üì∑</span><span>Scan</span>
        </div>
        <div class="nav-item">
          <span>üìñ</span><span>Diary</span>
        </div>
        <div class="nav-item">
          <span>üìà</span><span>Progress</span>
        </div>
        <div class="nav-item">
          <span>‚öôÔ∏è</span><span>Settings</span>
        </div>
      </nav>
    </aside>
    
    <main class="main-content">
      <div class="header">
        <h2>Today's Summary</h2>
        <span class="date-badge" id="currentDate"></span>
      </div>
      
      <div class="dashboard-grid">
        <div class="card">
          <div class="card-title">Calories Remaining</div>
          <div class="big-number" id="caloriesRemaining">2000</div>
          <div class="subtitle">of 2000 daily goal</div>
          <div class="macro-row">
            <div class="macro-item">
              <div class="macro-dot" style="background: #4CAF50;"></div>
              <span class="macro-text">Protein: <span id="proteinActual">0</span>g / <span id="proteinGoal">150</span>g</span>
            </div>
            <div class="macro-item">
              <div class="macro-dot" style="background: #2196F3;"></div>
              <span class="macro-text">Carbs: <span id="carbsActual">0</span>g / <span id="carbsGoal">250</span>g</span>
            </div>
            <div class="macro-item">
              <div class="macro-dot" style="background: #FF9800;"></div>
              <span class="macro-text">Fat: <span id="fatActual">0</span>g / <span id="fatGoal">65</span>g</span>
            </div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-title">Quick Actions</div>
          <div class="quick-actions">
            <button class="action-btn" onclick="document.getElementById('barcodeSection').scrollIntoView({behavior: 'smooth'})">
              <div class="action-icon">üì∑</div>
              <div class="action-text">Scan Food</div>
            </button>
            <button class="action-btn" onclick="showWaterModal()">
              <div class="action-icon">üíß</div>
              <div class="action-text">Add Water</div>
            </button>
            <button class="action-btn" onclick="showWeightModal()">
              <div class="action-icon">‚öñÔ∏è</div>
              <div class="action-text">Log Weight</div>
            </button>
            <button class="action-btn" onclick="searchFood()">
              <div class="action-icon">üîç</div>
              <div class="action-text">Search</div>
            </button>
          </div>
        </div>
        
        <div class="card">
          <div class="card-title">üíß Water Intake</div>
          <div class="water-count" id="waterCount">0</div>
          <div class="subtitle">glasses today</div>
          <div class="water-icons" id="waterIcons"></div>
        </div>
      </div>
      
      <h3 class="section-title">Today's Meals</h3>
      <div class="meals-list">
        <div class="meal-item">
          <span class="meal-name">üç≥ Breakfast</span>
          <span class="meal-calories" id="breakfastCalories">0 cal</span>
        </div>
        <div class="meal-item">
          <span class="meal-name">ü•ó Lunch</span>
          <span class="meal-calories" id="lunchCalories">0 cal</span>
        </div>
        <div class="meal-item">
          <span class="meal-name">üçΩÔ∏è Dinner</span>
          <span class="meal-calories" id="dinnerCalories">0 cal</span>
        </div>
        <div class="meal-item">
          <span class="meal-name">üçø Snacks</span>
          <span class="meal-calories" id="snacksCalories">0 cal</span>
        </div>
      </div>
      
      <div class="barcode-input-section" id="barcodeSection">
        <h3 class="section-title">üì∑ Quick Scan</h3>
        <p style="color: #666; margin-bottom: 8px;">Enter a barcode number to look up nutritional info:</p>
        <div class="barcode-input-group">
          <input type="text" class="barcode-input" id="barcodeInput" placeholder="Enter barcode (e.g., 3017620422003)">
          <button class="btn btn-primary" onclick="lookupBarcode()">Lookup</button>
        </div>
        
        <div id="productResult" style="display: none;">
          <div class="product-result">
            <div class="product-name" id="productName">Product Name</div>
            <div class="product-brand" id="productBrand">Brand</div>
            <div class="nutrition-grid">
              <div class="nutrition-item">
                <div class="nutrition-value" id="productCalories">0</div>
                <div class="nutrition-label">calories</div>
              </div>
              <div class="nutrition-item">
                <div class="nutrition-value" id="productProtein">0g</div>
                <div class="nutrition-label">protein</div>
              </div>
              <div class="nutrition-item">
                <div class="nutrition-value" id="productCarbs">0g</div>
                <div class="nutrition-label">carbs</div>
              </div>
              <div class="nutrition-item">
                <div class="nutrition-value" id="productFat">0g</div>
                <div class="nutrition-label">fat</div>
              </div>
            </div>
            <div class="add-to-meal">
              <p style="margin-bottom: 8px; font-weight: 500;">Add to meal:</p>
              <div class="meal-selector">
                <div class="meal-option" onclick="selectMeal(this, 'breakfast')">Breakfast</div>
                <div class="meal-option active" onclick="selectMeal(this, 'lunch')">Lunch</div>
                <div class="meal-option" onclick="selectMeal(this, 'dinner')">Dinner</div>
                <div class="meal-option" onclick="selectMeal(this, 'snacks')">Snacks</div>
              </div>
              <div class="serving-control">
                <button class="serving-btn" onclick="adjustServings(-0.25)">‚àí</button>
                <span class="serving-value"><span id="servingValue">1</span> serving(s)</span>
                <button class="serving-btn" onclick="adjustServings(0.25)">+</button>
              </div>
              <button class="btn btn-primary" style="width: 100%;" onclick="addToDiary()">+ Add to Diary</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
  
  <script>
    // State
    let currentProduct = null;
    let selectedMeal = 'lunch';
    let servings = 1;
    let todayLog = { foods: [], waterGlasses: 0 };
    let settings = {
      dailyCalorieGoal: 2000,
      dailyProteinGoal: 150,
      dailyCarbsGoal: 250,
      dailyFatGoal: 65,
      weightUnit: 'kg'
    };
    
    // Initialize
    document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-GB', {
      weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
    });
    
    // Load data from localStorage
    function loadData() {
      const savedLog = localStorage.getItem('foodDiary_log_' + new Date().toISOString().split('T')[0]);
      if (savedLog) todayLog = JSON.parse(savedLog);
      
      const savedSettings = localStorage.getItem('foodDiary_settings');
      if (savedSettings) settings = JSON.parse(savedSettings);
      
      updateDisplay();
    }
    
    // Save data to localStorage
    function saveData() {
      localStorage.setItem('foodDiary_log_' + new Date().toISOString().split('T')[0], JSON.stringify(todayLog));
      localStorage.setItem('foodDiary_settings', JSON.stringify(settings));
    }
    
    // Update all displays
    function updateDisplay() {
      // Calculate totals
      const totals = todayLog.foods.reduce((sum, food) => ({
        calories: sum.calories + food.calories * food.servings,
        protein: sum.protein + food.protein * food.servings,
        carbs: sum.carbs + food.carbs * food.servings,
        fat: sum.fat + food.fat * food.servings
      }), { calories: 0, protein: 0, carbs: 0, fat: 0 });
      
      // Update calories
      const remaining = settings.dailyCalorieGoal - totals.calories;
      const calEl = document.getElementById('caloriesRemaining');
      calEl.textContent = Math.max(0, remaining);
      calEl.className = 'big-number' + (remaining < 0 ? ' over' : '');
      
      // Update macros
      document.getElementById('proteinActual').textContent = Math.round(totals.protein);
      document.getElementById('carbsActual').textContent = Math.round(totals.carbs);
      document.getElementById('fatActual').textContent = Math.round(totals.fat);
      document.getElementById('proteinGoal').textContent = settings.dailyProteinGoal;
      document.getElementById('carbsGoal').textContent = settings.dailyCarbsGoal;
      document.getElementById('fatGoal').textContent = settings.dailyFatGoal;
      
      // Update water
      document.getElementById('waterCount').textContent = todayLog.waterGlasses;
      const waterIcons = document.getElementById('waterIcons');
      waterIcons.innerHTML = Array(Math.min(todayLog.waterGlasses, 8)).fill('<span class="water-icon">üíß</span>').join('');
      
      // Update meal calories
      const mealTotals = { breakfast: 0, lunch: 0, dinner: 0, snacks: 0 };
      todayLog.foods.forEach(food => {
        mealTotals[food.consumedMeal] += food.calories * food.servings;
      });
      
      document.getElementById('breakfastCalories').textContent = Math.round(mealTotals.breakfast) + ' cal';
      document.getElementById('lunchCalories').textContent = Math.round(mealTotals.lunch) + ' cal';
      document.getElementById('dinnerCalories').textContent = Math.round(mealTotals.dinner) + ' cal';
      document.getElementById('snacksCalories').textContent = Math.round(mealTotals.snacks) + ' cal';
    }
    
    // Lookup barcode
    async function lookupBarcode() {
      const barcode = document.getElementById('barcodeInput').value.trim();
      if (!barcode) return;
      
      try {
        const response = await fetch(`https://world.openfoodfacts.org/api/v0/product/${barcode}.json`);
        const data = await response.json();
        
        if (data.status === 1 && data.product) {
          currentProduct = {
            barcode: barcode,
            name: data.product.product_name || 'Unknown Product',
            brand: data.product.brands,
            servingSize: data.product.serving_size || '100g',
            calories: data.product.nutriments?.['energy-kcal_100g'] || 0,
            protein: data.product.nutriments?.proteins_100g || 0,
            carbs: data.product.nutriments?.carbohydrates_100g || 0,
            fat: data.product.nutriments?.fat_100g || 0
          };
          
          document.getElementById('productName').textContent = currentProduct.name;
          document.getElementById('productBrand').textContent = currentProduct.brand || '';
          document.getElementById('productCalories').textContent = Math.round(currentProduct.calories);
          document.getElementById('productProtein').textContent = Math.round(currentProduct.protein) + 'g';
          document.getElementById('productCarbs').textContent = Math.round(currentProduct.carbs) + 'g';
          document.getElementById('productFat').textContent = Math.round(currentProduct.fat) + 'g';
          
          document.getElementById('productResult').style.display = 'block';
        } else {
          alert('Product not found. Try another barcode.');
          document.getElementById('productResult').style.display = 'none';
        }
      } catch (error) {
        alert('Error looking up product: ' + error.message);
      }
    }
    
    // Select meal
    function selectMeal(el, meal) {
      document.querySelectorAll('.meal-option').forEach(opt => opt.classList.remove('active'));
      el.classList.add('active');
      selectedMeal = meal;
    }
    
    // Adjust servings
    function adjustServings(delta) {
      servings = Math.max(0.25, servings + delta);
      document.getElementById('servingValue').textContent = servings.toFixed(2);
    }
    
    // Add to diary
    function addToDiary() {
      if (!currentProduct) return;
      
      todayLog.foods.push({
        ...currentProduct,
        consumedDate: new Date().toISOString().split('T')[0],
        consumedMeal: selectedMeal,
        servings: servings
      });
      
      saveData();
      updateDisplay();
      
      alert('Added to diary!');
      
      // Reset
      currentProduct = null;
      servings = 1;
      document.getElementById('productResult').style.display = 'none';
      document.getElementById('barcodeInput').value = '';
      document.getElementById('servingValue').textContent = '1';
    }
    
    // Initialize
    loadData();
  </script>
</body>
</html>
